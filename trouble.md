
# 웹 개발자의 장애 대응
    
### 장애란 무엇인가
장애는 서비스를 제공함에 있어 결함이 발생해 서비스를 원할히 이용할 수 없는 경우를 말합니다.  
장애에는 사용자가 눈치채기 힘든것 부터 서비스가 제공되지 않은것 까지 다양한 레벨의 장애가 있습니다.  
  
## 장애에 대응하는 마음가짐
  
### 당황하지 않기
장애를 마주하는 가장 첫번째 마음가짐은 당황하지 않는 것 입니다.  
장애는 웹개발자에 있어서 재난과도 같은일 입니다. 재난에서 살아남는 첫번째는 당황하지 않는 것 입니다.  
저 역시 잘못된 DELETE 문으로 라이브 데이터 베이스를 날렸을때 머리속도 같이 날아가 버리는 줄 알았습니다만...  
당황한다고 해결되는 것은 없습니다. 물론 자책한다고 해결되는것도 없습니다.
  
#### 장애없는 서비스는 없다.
완벽한 프로그램은 없듯이 장애없는 서비스는 없습니다.  
장애는 긍정적으로 보면 서비스를 좀더 완벽히 만들수 있는 기회 입니다.  

### 장애 대응에만 집중하기
장애의 원인이 본인이라면 장애의 책임때문에 많은 생각이 순식간에 지나갑니다.  
첫번째로 장애보고서 부터 해서 징계까지도 생각나지만 중요한건 장애를 처리하는 것입니다.  
사후에 격게될 일을 지금 생각한다고 해결되는 것은 없습니다.

### 웹개발자를 키우는 것은 장애
몬스터를 잡아 레벨업을 하는 기사처럼 웹 개발자들은 장애들을 경험치로 성장하게 됩니다.  
지금까지 많은 개발자들이 걸어온 길이며 앞으로도 걸어갈 길입니다.  
  
  
## 장애 대응 순서
### 어찌되었건 첫번째는 장애가 발생하지 않는것
장애에서 많은 것을 배울수 있지만 첫번째는 장애가 발생하지 않는 것 입니다.  
그것을 위해 테스트 및 꼼꼼한 QA, 정확한 예외처리가 선행이 되어야 합니다.

### 장애 원인은 범죄자를 찾듯이
장애 원인은 다양합니다. 웹서버의 물리적 문제부터 사용자의 악의적 행위까지 예상할수 없는 경로로 장애는 발생합니다.  
그러면 어떻게 찾아야 빠르고 정확하게 찾을수 있을까요?  
범죄자를 찾듯이 장애가 남긴 흔적들을 쫒아가면 그 끝에 원인이 있습니다.
  
#### 응답코드
HTTP의 응답코드에는 장애 관련 4xx와 5xx가 있습니다.  
일단 클라이언트의 문제인지 서버의 문제인지 그리고 대략적으로 어떤부분이 문제인지 확인할 수 있습니다.  
따라서 상황에 맞는 응답코드를 내려주도록 개발하도록 합니다.  
하지만 응답코드가 항상 장애의 원인과 맞는 것은 아니므로 참고로만 사용합시다.  
  
#### 로그
많은 WAS에서는 표준 엑세스 로그를 제공합니다. 표준 엑세스 로그가 담고 있는 정보는 장애 대응의 많은 도움이 됩니다.  
표준 엑세스 로그를 분석하는 방법을 익히도록 합시다.  
  
자바를 비롯해 많은 언어들에서 오류 로그를 남길수 있습니다. 어플리케이션단이 문제라면 오류로그가 많은 도움이 됩니다.  
하지만 오류 로그에 남겨진곳이 원인이 아닐 가능성도 있으므로 오류 로그에서 원인을 찾는 방법을 익히도록 합시다.  
  
데이터베이스에서는 슬로우 쿼리를 로그로 남길수 있습니다. DB가 장애의 원인일 경우 많은 도움이 됩니다.  
슬로우 쿼리를 파악할줄 아는 방법을 익히도록 합니다.  
  
장애원인을 찾기위해서는 로그가 거의 필수적입니다. 중요한 흐름에서는 로그를 남기는 습관을 들입시다.  
장애복구에서도 로그는 많은 도움이 됩니다.  로그를 보고 복구를 할수 있는 데이터들도 있습니다.

#### AMP
서버 상태나 트래픽을 확인할수 있는 모니터링 툴 또한 장애 원인 파악에 도움이 됩니다.  
간단히는 리눅스의 ps,top 명령어 부터 ELK의 AMP 까지 현재 서버 상태를 파악하는 방법을 익히도록 합시다.

#### 사용자의 흐름중에 원인이 있다
당연하게도 사용자의 흐름을 따라가다보면 장애 원인이 있습니다.  
  
브라우저 - 네트워크 - 서버 - WAS - 어플리케이션 - 데이터베이스  
  
하나 하나씩 제대로 동작하는지 흐름을 따라서 확인해봅시다.  
예상가는 곳이 있다면 그 부분부터 앞 뒤로 확인해봅시다.  

#### 장애의 상황을 재현해보자
장애 상황을 정확히 재현 가능하면 장애상황을 재현하여 사용자 흐름을 따라가면 쉽게 찾을수 있습니다.
디버깅과 중단점을 사용할 수 있다면 예상가는 지점에 우선 중단점을 설정하고 잘못된것이 없는지 확인해봅시다.

### 장애처리는 중요도에 따라
장애 원인에 따라 처리 방법도 다양합니다.  
또한 당장 처리 할수 없는 장애도 있습니다.  
이때 중요한 것은 서비스를 사용자에게 제공할수 있는 것을 목표로 합시다.  
  
데이터 때문에 생긱 장애인경우 복구가 오래걸립니다. 하지만 이 복구 때문에 서비스가 되지 않으면 안됩니다.  
일단 없는 데이터라도 서비스를 할수 있는 부분은 처리를 하여 사용자가 이용 가능하게 해야합니다.  
  
중요한것은 오류 수정이나 데이터 복구가 아닌 서비스의 이용입니다.  
개발자는 개발적인면을 중요시 하기 때문에 오류수정에 포커스를 맞추는 경우가 있습니다만  
당장 오류가 수정되지 않아도 서비스를 할수 있는 방법이 있다면 그쪽이 우선입니다.  

### 새로만드는 것도 방법
장애의 원인이 너무 복잡하거나 오래된 시스템이 문제인경우 리펙토링이 답이 될수도 있습니다.  
대응의 규모가 커질수 있으니 이부분은 서비스의 중요도와 장애가 자주일어나는 지에 따라 판단하여 진행하도록 합시다.

## 장애 대응후
### 기록하기
같은 장애를 다시 겪지 않으려면 원인과 해결방법을 기록해둡시다.  
나 뿐만아니라 동료도 같은 장애시에 빠른 대응을 할수 있게 됩니다.  
장애 대응의 기록은 본인에게는 누구에게도 없는 자산이 될것 입니다.

### 마지막으로
너무 당연한 말만 써 놓았으나 장애는 웹개발자면 언제든 마주해야 하는 존재입니다.  
당연하다고 생각되는 만큼 중요한 부분이므로 장애시에 한번쯤 생각해봐야 하는 것들 이므로 당황하지 않고 처리해보도록 합시다.
